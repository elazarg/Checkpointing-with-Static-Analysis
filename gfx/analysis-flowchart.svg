<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 360" role="img" aria-labelledby="title desc">
  <title id="title">Analysis Flow</title>
  <desc id="desc">Left: Python Source → CPython Stack Bytecode → Spytecode Register IR. Middle: 2×2 grid with Type ↔ Pointer, Liveness → Pointer → Dirty. Right: Reachable(Live) ∩ Dirty → Instrumented Python.</desc>

  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="9.5" refY="5" markerWidth="8" markerHeight="8" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#000"/>
    </marker>
    <marker id="arrowhead" viewBox="0 0 10 10" refX="9" refY="5"
            markerWidth="7" markerHeight="7" orient="auto">
        <path d="M 0 0 L 10 5 L 0 10 z" fill="#000"/>
    </marker>
    <marker id="arrow-right" viewBox="0 0 10 10" refX="9" refY="5"
            markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="black"/>
    </marker>
    <marker id="arrow-left" viewBox="0 0 10 10" refX="1" refY="5"
            markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 10 0 L 0 5 L 10 10 z" fill="black"/>
    </marker>
    <style>
      .box   { fill:#fff; stroke:#000; stroke-width:2; }
      .frame { fill:none; stroke:#000; stroke-width:2.2; }
      .label { font-family: serif; font-size:18px; fill:#000; text-anchor:middle; dominant-baseline:middle; }
      .title { font-family: serif; font-weight:bold; font-size:20px; fill:#000; text-anchor:middle; }
      .dash  { stroke-dasharray:6 6; }
    </style>
  </defs>
  <!-- ===== Left column ===== -->
  <text class="title" x="170" y="10">Compilation</text>

  <rect class="box" x="40"  y="40"  width="270" height="70" rx="14" ry="14"/>
  <text class="label" x="170" y="75">Python Source</text>

  <rect class="box" x="40"  y="130" width="270" height="70" rx="14" ry="14"/>
  <text class="label" x="170" y="165">CPython Stack Bytecode</text>

  <rect class="box" x="40"  y="220" width="270" height="70" rx="14" ry="14"/>
  <text class="label" x="170" y="255">Spytecode Register IR</text>

  <!-- Vertical connectors -->
  <line x1="170" y1="110" x2="170" y2="130" stroke="#000" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="170" y1="200" x2="170" y2="220" stroke="#000" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- IR → Framework (left edge, near Liveness) -->
  <line x1="310" y1="255" x2="360" y2="255" stroke="#000" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ===== Middle: Analysis Framework ===== -->
  <rect class="frame" x="360" y="40" width="500" height="250" rx="10" ry="10"/>
  <text class="title" x="610" y="10">Analysis</text>

  <!-- Combined Domain (top row dashed frame) -->
  <rect class="frame dash" x="380" y="50" width="460" height="100" rx="10" ry="10"/>
  <text class="label" x="610" y="65">Combined Domain</text>

  <!-- Top row: Pointer (left), Type (right) -->
  <rect class="box" x="400" y="80" width="180" height="60" rx="14" ry="14"/>
  <text class="label" x="490" y="110">Pointer</text>

  <rect class="box" x="640" y="80" width="180" height="60" rx="14" ry="14"/>
  <text class="label" x="730" y="110">Type</text>

  <!-- Bottom row: Liveness (left), Dirty (right) -->
  <rect class="box" x="400" y="200" width="180" height="60" rx="14" ry="14"/>
  <text class="label" x="490" y="230">Liveness</text>

  <rect class="box" x="640" y="200" width="180" height="60" rx="14" ry="14"/>
  <text class="label" x="730" y="230">Dirty</text>

  <!-- Internal flows -->
  <!-- Liveness -> Pointer (straight up) -->
  <line x1="490" y1="200" x2="490" y2="140" stroke="#000" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Pointer -> Dirty (curved from bottom-right of Pointer to top-center of Dirty) -->
  <path d="M 570 140 C 620 150, 670 170, 730 200" fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Type ↔ Pointer (dashed, bidirectional) in the gap -->
  <line x1="580" y1="110" x2="640" y2="110" stroke="#000" stroke-width="2" class="dash"
        marker-start="url(#arrow-left)" marker-end="url(#arrow-right)"/>

  <!-- Framework → Right column (to center of Reachable box) -->
  <line x1="860" y1="115" x2="900" y2="115" stroke="#000" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ===== Right column ===== -->
  <text class="title" x="1035" y="10">Synthesis</text>

  <rect class="box" x="900" y="80"  width="270" height="70" rx="14" ry="14"/>
  <text class="label" x="1035" y="115">Reachable(Live) ∩ Dirty</text>

  <rect class="box" x="900" y="190" width="270" height="70" rx="14" ry="14"/>
  <text class="label" x="1035" y="225">Instrumented Python</text>

  <line x1="1050" y1="150" x2="1050" y2="190" stroke="#000" stroke-width="2" marker-end="url(#arrow)"/>
</svg>
